/*
==============================================================================
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
==============================================================================
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░████╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░╚████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░██╗░░██╗░█████╗░░█████╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░██║░░██║██╔══██╗██╔══██╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░███████║███████║██║░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░██╔══██║██╔══██║██║░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░██║░░██║██║░░██║╚█████╔╝░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░╚═╝░░╚═╝╚═╝░░╚═╝░╚════╝░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░██████╗░██╗░░░██╗░█████╗░███╗░░██╗░██████╗░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░██╔═══██╗██║░░░██║██╔══██╗████╗░██║██╔════╝░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░██║██╗██║██║░░░██║███████║██╔██╗██║██║░░██╗░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░╚██████╔╝██║░░░██║██╔══██║██║╚████║██║░░╚██╗░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░╚═██╔═╝░╚██████╔╝██║░░██║██║░╚███║╚██████╔╝░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚═╝░░╚══╝░╚═════╝░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
==============================================================================
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
==============================================================================

    @version v8.16.2
    @script-version 1.4.0
    @athour ChoiGame123 (dis: Choigame 123 #5666)
    @dependent ChoigameRP - v3.0.3
    @helper nope
    @special-thank Nguyễn Vương (dis: NSNguyenVuong #2303)
    @license MIT

    Discord link: <a herf="https://discord.gg/2dnE2uT49r">click here</a>
    File path: /storage/emulated/0/Android/data/com.mojang.minecraftpe/files/games/com.mojang/minecraftWorlds/new\ api/behavior_packs/ChoigameBP/scripts
*/
import{world as t,Player as e ,ItemStack as o,system as r,BlockPermutation as i,Container as s,Direction as a,Block as c}from"@minecraft/server";var $={container:["minecraft:chest","minecraft:trapped_chest","minecraft:barrel"],direction:{0:"down",1:"up",2:"north",3:"south",4:"west",5:"east"},signDirection:{0:"south",1:"south-south-west",2:"south-west",3:"west-south-west",4:"west",5:"west-north-west",6:"north-west",7:"north-north-west",8:"north",9:"north-north-east",10:"north-east",11:"north-east-north",12:"east",13:"east-south-east",14:"south-east",15:"south-south-east"},redstoneDirection:{0:"north",1:"east",2:"south",3:"west"}};let history={};
t.beforeEvents.itemUseOn.subscribe(t=>r.runTimeout(()=>chestPicker(t),8)),t.afterEvents.itemStartUseOn.subscribe(chestPlacer),t.afterEvents.itemUse.subscribe(({source:t,itemStack:n})=>{if(t instanceof e&&!n&&["id s\xfag ghi v\xf4 đ\xe2y","đơn giản dễ hiểu","minecraft:bow"].includes(n.typeId)){let[o,r,i]=Object.values(t.location).map(t=>Math.floor(t));t.runCommandAsync(`execute at @s as @e[r=30] as @s run tellraw @s {"rawtext":[{"text":"${t.name} đang ở ${o}, ${r}, ${i}"}]}`)}}),s.prototype.cloneAll=function(){
return Array.from({length:this.size},(t,e)=>this.getItem(e))},s.prototype.setWith=function(t){return t.forEach((t,e)=>this.setItem(e,t)),this},String.prototype.firstUpperCase=function(){return this.slice(0,1).toUpperCase()+this.slice(1)},String.prototype.removeNameSpace=function(){
return this.split(":")[1]??this},String.prototype.removeUnderScope=function(){return this.replace("_"," ")},String.prototype.ID2Name=function(){return this.removeNameSpace().removeUnderScope().split(" ").map(t=>t.firstUpperCase()).join(" ")},String.prototype.toId=function(){let t=e=>{let n=e.replace(/[xyz]/g,t=>{let e=(new Date().getTime()+16*Math.random())%16|0;
return("x"==t?e:"z"==t?e>8?"-":"_":3&e|8).toString(16)});return Number.isNaN(+n)?n:t(e)};return t(this)},e.prototype.getFacingDirection2D=function(){let{x:t,z:e}=this.getViewDirection(),n={x:Math.abs(t),z:Math.abs(e)},o={x:t<0,z:e<0},r,i=[n.x,n.z].indexOf(Math.max(n.x,n.z));switch(["x","z"][i]){case"x":
return o.x?"east":"west";case"z":return o.z?"south":"north"}},e.prototype.getDirection=function(t=!1){let{x:e,y:n,z:o}=this.getViewDirection(),r={x:Math.abs(e),y:Math.abs(n),z:Math.abs(o)},i={x:e<0,y:n<0,z:o<0};i.x=i.x!==t,i.y=i.y!==t,i.z=i.z!==t;let s,a=[r.x,r.y,r.z].indexOf(Math.max(r.x,r.y,r.z));
switch(["x","y","z"][a]){case"x":return i.x?"west":"east";case"y":return i.y?"down":"up";case"z":return i.z?"north":"south"}},e.prototype.addItem=function(t){let e=this.getComponent("inventory").container,n=e.emptySlotsCount;
return e.getItem(this.selectedSlot)?n?e.addItem(t):void this.dimension.spawnItem(t,this.location):e.setItem(this.selectedSlot,t)},c.prototype.setAir=function(){this.setType("minecraft:air")},c.prototype.commandSetAir=function(){return this.dimension.runCommandAsync(`setblock ${this.x} ${this.y} ${this.z} air`)},c.prototype.break=function(){
return this.dimension.runCommandAsync(`fill ${this.x} ${this.y} ${this.z} ${this.x} ${this.y} ${this.z} air 0 destroy`)},o.prototype.toString=function(){return"minecraft:air"===this.typeId?"minecraft:air":[this.typeId,this.nameTag,...this.getLore()].join(" ")};class vec3{static offset({x:t,y:e,z:o},r,i,s,a=!1){
return t+=r,e+=i,o+=s,a?new n(t,e,o):{x:t,y:e,z:o}}static faceOffset({x:t,y:e,z:o},r,i=!1){switch(r){case a.Up:e+=1;break;case a.Down:e-=1;break;case a.East:t+=1;break;case a.North:o-=1;break;case a.West:t-=1;break;case a.South:o+=1;break;default:throw SyntaxError("Not a direction")}
return i?new n(t,e,o):{x:t,y:e,z:o}}}async function chestPicker({source:t,itemStack:r,block:i}){let s=Date.now();if(!(t instanceof e)||!r||!i||"choigame:chest_transporter"!==r.typeId||s-history[t.id]<400)return;let a=new n(i.location.x,i.location.y,i.location.z),c=t.dimension,u=t.getComponent("inventory").container,
m=t=>["minecraft:chest","minecraft:trapped_chest"].includes(t.typeId),h=async(e,{x:n,y:o,z:r},{x:i,y:s,z:a})=>{c.runCommand(`structure save scripts:${e} ${n} ${o} ${r} ${i} ${s} ${a} disk`),c.runCommand(`fill ${n} ${o} ${r} ${i} ${s} ${a} air`),t.playSound("dig.wood",{volume:1.2})};if($.container.includes(i.typeId))try{if(!t.isSneaking)
return t.sendMessage("§cYou need sneaking to pick a block!");history[t.id]=s;let l=`§${"xyxxyxyyxxyxyyxy".toId().split("").join("§")}`,p=i.getComponent("inventory").container,d=$.direction[i.permutation.getState("facing_direction")],f="§r§aChest Picker:§b ",y=[`§6Chest picker`," "],g=i.typeId.split(":")[1],w=new o(g,1),x=(e,n)=>{w.nameTag=n,w.setLore(e),u.setItem(t.selectedSlot,w)};if(p.cloneAll().some(t=>t?.getLore()?.[0]===y[0]))
return t.sendMessage("§cYou cannot pick chest/barrel containing another picker");if("minecraft:barrel"!==i.typeId&&p.size>=54){let _=a,I=a,k,v,b,S,z,C=t.dimension.spawnEntity("choigame:nothing",a),D=C.getComponent("inventory").container,A=new o("choigame:nothing",1),B=
new o("minecraft:air",1);["east","west"].includes(d)?(_=vec3.offset(_,0,0,1),I=vec3.offset(I,0,0,-1)):(_=vec3.offset(_,1,0,0),I=vec3.offset(I,-1,0,0));let N=c.getBlock(_),T=c.getBlock(I),U=i.getComponent("inventory").container;A.setLore([l]),D.setItem(0,A),U.getItem(0)||(U.setItem(0,A),S=!0),m(N)&&(k=N.getComponent("inventory").container),m(T)&&(v=T.getComponent("inventory").container),
D.swapItems(0,0,U);let E=t=>t&&(b=t.getItem(0))?.typeId==="choigame:nothing"&&b.getLore()[0]===l;return E(k)&&(z=_),E(v)&&(z=I),U.swapItems(0,0,D),D.setItem(0,B),C.triggerEvent("die"),S&&U.setItem(0,B),await h(`${l}_${d}_true`,a,z),y[1]=`§6NBT:§k scripts:${l}_${d}_true`,f+=`Double ${g.ID2Name()}`,x(y,f)}
return await h(`${l}_${d}_false`,a,a),y[1]=`§6NBT:§k scripts:${l}_${d}_false`,f+=g.ID2Name(),x(y,f)}catch(P){t.sendMessage("§c"+P+P.stack+"\n§4Send it to admin to get fix soon as possible"),t.onScreenDisplay.setActionBar("§cA serious error has occurred")}return t.onScreenDisplay.setActionBar("§cYou can take chest or barrel only")}async function chestPlacer({itemStack:t,blockFace:n,source:s,block:a}){try{let c;
if(!(s instanceof e)||!n||!t||!a||!t||!$.container.includes(t.typeId)||!(c=t.getLore())||!c.length||c.length<2||!c[1].startsWith(`§6NBT:§k`))return;let u=vec3.faceOffset(a.location,n,!0),m=s.getComponent("inventory").container,h=s.dimension.getBlock(u);if(`${m.getItem(s.selectedSlot)}`==`${t}`)return;if(h.setPermutation(i.resolve("air")),s.isSneaking)
return s.onScreenDisplay.setActionBar(`§cYou must not shift when you need to place`),r.runTimeout(()=>s.addItem(t),4);s.runCommandAsync("testfor @s[m=c]").catch().then(t=>t&&t.successCount&&m.setItem(s.selectedSlot,new o("minecraft:air")));let l=s.getFacingDirection2D(),p=s.getDirection(!0),d=c[1].split(" ")[1];if(!d&&!d.startsWith("script:"))
return;let f=["east","south","west","north","east","south","west","north"],y="true"===d.split("_")[2],g,w,x=d.split("_")[1],_=f.findIndex(t=>t===x)+1,I=0;if(y&&(w=["south","north"].includes(l),g=vec3.offset(u,w?1:0,0,w?0:1)),g&&"minecraft:air"!==s.dimension.getBlock(g).typeId)return s.onScreenDisplay.setActionBar(`§cNot enough space`),r.runTimeout(()=>s.addItem(t),4);for(r.runTimeout(()=>s.addItem(
new o("choigame:chest_transporter"),4));f[_]!==l;_++)I++;if(await s.runCommandAsync(`structure load ${d} ${u.x} ${u.y} ${u.z} ${[90,180,270,0][I]}_degrees none false true false`),s.runCommandAsync(`structure delete ${d}`),s.playSound("item.book.put",{volume:1.2}),"minecraft:barrel"===t.typeId){let k=s.dimension.getBlock(u),v=k.getComponent("inventory").container.cloneAll(),b=k.permutation.withState("facing_direction",+Object.entries($.direction).find(([,t])=>t===p)[0]);k.setPermutation(b),k.getComponent("inventory").container.setWith(v)}}catch(S){s.onScreenDisplay.setActionBar(`§cSomething gone wrong`),s.sendMessage(`
§c${S} ${S.stack}
 §4§lSend this to admin to get fix soon`)}}